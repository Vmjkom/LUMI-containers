name: LUMI Container Build Workflow 
run-name: ${{ github.actor }} is running LUMI container build workflow
on: [push]
env:
  OPENSTACK_IMAGE_NAME: "ghcr.io/${{ github.repository_owner }}/openstack:latest"
  SKIP_HELPER_FILES: "YES"
  SINGULARITY_BUILD_MAX_TIME: "1:00:00"
concurrency:
  group: cpouta-single-workflow
  cancel-in-progress: true
jobs:
#   OpenStack-Container-Check:
#     outputs:
#       run_job: ${{ steps.check_files.outputs.run_job }}
#     runs-on: ubuntu-latest
#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v2
#         with:
#           fetch-depth: 2
#       - name: check modified files
#         id: check_files
#         run: |
#           set -e
#           set -o pipefail
#           if git diff --name-only HEAD^ HEAD | grep 'ci/openstack/Dockerfile' ; then
#             echo "::set-output name=run_job::true"
#           else
#             echo "::set-output name=run_job::false"
#           fi
#   OpenStack-Container:
#     needs: OpenStack-Container-Check
#     if: needs.OpenStack-Container-Check.outputs.run_job == 'true'
#     runs-on: ubuntu-latest
#     permissions:
#       contents: read
#       packages: write
#     steps:
#       - uses: actions/checkout@v4
#       - name: Log in to registry
#         run: echo "${{ secrets.GITHUB_TOKEN }}" | docker login ghcr.io -u ${{ github.actor }} --password-stdin
#       - name: Build openstack image
#         run: |
#           docker pull $OPENSTACK_IMAGE_NAME || true
#           docker build ./ci/openstack --tag $OPENSTACK_IMAGE_NAME
#       - name: Push image
#         run: docker push $OPENSTACK_IMAGE_NAME
#   Start-Runner:
#     needs: OpenStack-Container
#     if: ${{ ! failure() && ! cancelled() }}
#     runs-on: ubuntu-latest
#     permissions: write-all
#     container:
#       image: "ghcr.io/${{ github.repository_owner }}/openstack:latest"
#       credentials:
#         username: ${{ github.actor }}
#         password: ${{ secrets.github_token }}
#       env:
#         OS_AUTH_TYPE: "${{ vars.OS_AUTH_TYPE }}"
#         OS_AUTH_URL: "${{ vars.OS_AUTH_URL }}"
#         OS_IDENTITY_API_VERSION: "${{ vars.OS_IDENTITY_API_VERSION }}"
#         OS_REGION_NAME: "${{ vars.OS_REGION_NAME }}"
#         OS_INTERFACE: "${{ vars.OS_INTERFACE }}"
#         OS_APPLICATION_CREDENTIAL_ID: "${{ secrets.OS_APPLICATION_CREDENTIAL_ID }}"
#         OS_APPLICATION_CREDENTIAL_SECRET: "${{ secrets.OS_APPLICATION_CREDENTIAL_SECRET }}"
#         OS_MY_FLAVOUR: "hpc.5.64core"
#         OS_MY_IMAGE: "828d8dde-6ed9-40cc-8fb6-9546a09a03e0"
#     steps:
#       - name: Remove old instance if exists
#         run: openstack server delete --wait production_containers_workflow || true
#       - name: Create instance
#         run: openstack server create --wait --flavor $OS_MY_FLAVOUR --image $OS_MY_IMAGE --key-name containers_workflow production_containers_workflow
#       - name: Assign server public IP
#         run: openstack server add floating ip production_containers_workflow ${{ secrets.CPOUTA_INSTANCE_IP }}
#       - name: Assign security group
#         run: |
#           set -e
#           set -o pipefail
#           openstack server add security group production_containers_workflow test_containers_workflow_sec_group 
#       - name: Assign volume
#         run: openstack server add volume production_containers_workflow test_containers_workflow_vol
# # Find a good way to check if the runner is on; maybe use SSH with nc -z ${{ secrets.CPOUTA_INSTANCE_IP }} 22
#       - name: Check runner is ready
#         run: |
#           sleep 10
#           # now=$(date +%s)
#           # timeout=$((now + 60))
#           # while [ $now -lt $timeout ] ; do
#           #   openstack server show production_containers_workflow
#           #   now=$(date +%s)
#           # done

  Prepare-Build-Containers:
    # needs: Start-Runner
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-main
    steps:
      # - name: Prepare VM for docker builds
      #   run: sudo prepare-vm
      - name: List Docker images
        run: docker images
      - name: Check out repository code
        uses: actions/checkout@v4
      - name: Capture Cray Environment
        run: |
          mkdir -p /media/podman-storage/work/ongoing/helper-files
          cp -rf * /media/podman-storage/work/ongoing/helper-files
          cd /media/podman-storage/work/ongoing/helper-files
          ./cpe-24.03.sh
          docker build -t h .
        working-directory: ${{ github.workspace }}/RecipesDocker/helper-files
      - name: Check out repository code
        uses: actions/checkout@v4
      - name: Remove old test folders
        run: |
          ssh lumi \
            "bash -ex -c '\
              find /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area -maxdepth 1 -mtime +7 -name 'time-*' | xargs rm -rf
              find /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area -maxdepth 1 -mtime +7 -name 'gh-*' | xargs rm -rf
              '"
  build-rocm-build-rocm-asan-6_2_3:
    needs: Prepare-Build-Containers
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta
    steps:
      - run: ./lumi-containers-build.sh ./rocm/build-rocm-asan-6.2.3.done 1
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  trf-rocm-build-rocm-asan-6_2_3:
    needs: build-rocm-build-rocm-asan-6_2_3
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-trf
    steps:
      - run: LUMI_TIMESTAMP="gh-${{ github.run_id }}/rocm-build-rocm-asan-6.2.3" TARGET_FILE="./rocm/build-rocm-asan-6.2.3.done" ./lumi-containers-transfer.sh
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  test-rocm-build-rocm-asan-6_2_3:
    needs: trf-rocm-build-rocm-asan-6_2_3
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-test
    steps:
      - name: build SIF image
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/rocm-build-rocm-asan-6.2.3/runtests && \
              srun -p standard-g -N 1 -n 1 -c 56 -t 1:00:00 $SINGULARITY_BUILD_MAX_TIME ./build-singularity-images.sh \
              '"
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/rocm-build-rocm-asan-6.2.3/runtests && \
              sbatch < test.sbatch \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/rocm-build-rocm-asan-6.2.3/runtests && \
              sbatch < test.sbatch |& tee jobid.info \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  build-rocm-build-rocm-asan-6_2_2:
    needs: Prepare-Build-Containers
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta
    steps:
      - run: ./lumi-containers-build.sh ./rocm/build-rocm-asan-6.2.2.done 1
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  trf-rocm-build-rocm-asan-6_2_2:
    needs: build-rocm-build-rocm-asan-6_2_2
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-trf
    steps:
      - run: LUMI_TIMESTAMP="gh-${{ github.run_id }}/rocm-build-rocm-asan-6.2.2" TARGET_FILE="./rocm/build-rocm-asan-6.2.2.done" ./lumi-containers-transfer.sh
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  test-rocm-build-rocm-asan-6_2_2:
    needs: trf-rocm-build-rocm-asan-6_2_2
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-test
    steps:
      - name: build SIF image
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/rocm-build-rocm-asan-6.2.2/runtests && \
              srun -p standard-g -N 1 -n 1 -c 56 -t 1:00:00 $SINGULARITY_BUILD_MAX_TIME ./build-singularity-images.sh \
              '"
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/rocm-build-rocm-asan-6.2.2/runtests && \
              sbatch < test.sbatch \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/rocm-build-rocm-asan-6.2.2/runtests && \
              sbatch < test.sbatch |& tee jobid.info \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  build-rocm-build-rocm-6_2_0:
    needs: Prepare-Build-Containers
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta
    steps:
      - run: ./lumi-containers-build.sh ./rocm/build-rocm-6.2.0.done 1
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  trf-rocm-build-rocm-6_2_0:
    needs: build-rocm-build-rocm-6_2_0
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-trf
    steps:
      - run: LUMI_TIMESTAMP="gh-${{ github.run_id }}/rocm-build-rocm-6.2.0" TARGET_FILE="./rocm/build-rocm-6.2.0.done" ./lumi-containers-transfer.sh
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  test-rocm-build-rocm-6_2_0:
    needs: trf-rocm-build-rocm-6_2_0
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-test
    steps:
      - name: build SIF image
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/rocm-build-rocm-6.2.0/runtests && \
              srun -p standard-g -N 1 -n 1 -c 56 -t 1:00:00 $SINGULARITY_BUILD_MAX_TIME ./build-singularity-images.sh \
              '"
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/rocm-build-rocm-6.2.0/runtests && \
              sbatch < test.sbatch \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/rocm-build-rocm-6.2.0/runtests && \
              sbatch < test.sbatch |& tee jobid.info \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  build-rocm-build-rocm-6_2_4:
    needs: Prepare-Build-Containers
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta
    steps:
      - run: ./lumi-containers-build.sh ./rocm/build-rocm-6.2.4.done 1
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  trf-rocm-build-rocm-6_2_4:
    needs: build-rocm-build-rocm-6_2_4
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-trf
    steps:
      - run: LUMI_TIMESTAMP="gh-${{ github.run_id }}/rocm-build-rocm-6.2.4" TARGET_FILE="./rocm/build-rocm-6.2.4.done" ./lumi-containers-transfer.sh
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  test-rocm-build-rocm-6_2_4:
    needs: trf-rocm-build-rocm-6_2_4
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-test
    steps:
      - name: build SIF image
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/rocm-build-rocm-6.2.4/runtests && \
              srun -p standard-g -N 1 -n 1 -c 56 -t 1:00:00 $SINGULARITY_BUILD_MAX_TIME ./build-singularity-images.sh \
              '"
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/rocm-build-rocm-6.2.4/runtests && \
              sbatch < test.sbatch \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/rocm-build-rocm-6.2.4/runtests && \
              sbatch < test.sbatch |& tee jobid.info \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  build-rocm-build-rocm-6_1_3:
    needs: Prepare-Build-Containers
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta
    steps:
      - run: ./lumi-containers-build.sh ./rocm/build-rocm-6.1.3.done 1
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  trf-rocm-build-rocm-6_1_3:
    needs: build-rocm-build-rocm-6_1_3
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-trf
    steps:
      - run: LUMI_TIMESTAMP="gh-${{ github.run_id }}/rocm-build-rocm-6.1.3" TARGET_FILE="./rocm/build-rocm-6.1.3.done" ./lumi-containers-transfer.sh
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  test-rocm-build-rocm-6_1_3:
    needs: trf-rocm-build-rocm-6_1_3
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-test
    steps:
      - name: build SIF image
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/rocm-build-rocm-6.1.3/runtests && \
              srun -p standard-g -N 1 -n 1 -c 56 -t 1:00:00 $SINGULARITY_BUILD_MAX_TIME ./build-singularity-images.sh \
              '"
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/rocm-build-rocm-6.1.3/runtests && \
              sbatch < test.sbatch \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/rocm-build-rocm-6.1.3/runtests && \
              sbatch < test.sbatch |& tee jobid.info \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  build-rocm-build-rocm-6_0_3:
    needs: Prepare-Build-Containers
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta
    steps:
      - run: ./lumi-containers-build.sh ./rocm/build-rocm-6.0.3.done 1
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  trf-rocm-build-rocm-6_0_3:
    needs: build-rocm-build-rocm-6_0_3
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-trf
    steps:
      - run: LUMI_TIMESTAMP="gh-${{ github.run_id }}/rocm-build-rocm-6.0.3" TARGET_FILE="./rocm/build-rocm-6.0.3.done" ./lumi-containers-transfer.sh
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  test-rocm-build-rocm-6_0_3:
    needs: trf-rocm-build-rocm-6_0_3
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-test
    steps:
      - name: build SIF image
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/rocm-build-rocm-6.0.3/runtests && \
              srun -p standard-g -N 1 -n 1 -c 56 -t 1:00:00 $SINGULARITY_BUILD_MAX_TIME ./build-singularity-images.sh \
              '"
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/rocm-build-rocm-6.0.3/runtests && \
              sbatch < test.sbatch \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/rocm-build-rocm-6.0.3/runtests && \
              sbatch < test.sbatch |& tee jobid.info \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  build-rocm-build-rocm-6_2_1:
    needs: Prepare-Build-Containers
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta
    steps:
      - run: ./lumi-containers-build.sh ./rocm/build-rocm-6.2.1.done 1
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  trf-rocm-build-rocm-6_2_1:
    needs: build-rocm-build-rocm-6_2_1
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-trf
    steps:
      - run: LUMI_TIMESTAMP="gh-${{ github.run_id }}/rocm-build-rocm-6.2.1" TARGET_FILE="./rocm/build-rocm-6.2.1.done" ./lumi-containers-transfer.sh
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  test-rocm-build-rocm-6_2_1:
    needs: trf-rocm-build-rocm-6_2_1
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-test
    steps:
      - name: build SIF image
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/rocm-build-rocm-6.2.1/runtests && \
              srun -p standard-g -N 1 -n 1 -c 56 -t 1:00:00 $SINGULARITY_BUILD_MAX_TIME ./build-singularity-images.sh \
              '"
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/rocm-build-rocm-6.2.1/runtests && \
              sbatch < test.sbatch \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/rocm-build-rocm-6.2.1/runtests && \
              sbatch < test.sbatch |& tee jobid.info \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  build-rocm-build-rocm-6_2_2:
    needs: Prepare-Build-Containers
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta
    steps:
      - run: ./lumi-containers-build.sh ./rocm/build-rocm-6.2.2.done 1
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  trf-rocm-build-rocm-6_2_2:
    needs: build-rocm-build-rocm-6_2_2
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-trf
    steps:
      - run: LUMI_TIMESTAMP="gh-${{ github.run_id }}/rocm-build-rocm-6.2.2" TARGET_FILE="./rocm/build-rocm-6.2.2.done" ./lumi-containers-transfer.sh
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  test-rocm-build-rocm-6_2_2:
    needs: trf-rocm-build-rocm-6_2_2
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-test
    steps:
      - name: build SIF image
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/rocm-build-rocm-6.2.2/runtests && \
              srun -p standard-g -N 1 -n 1 -c 56 -t 1:00:00 $SINGULARITY_BUILD_MAX_TIME ./build-singularity-images.sh \
              '"
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/rocm-build-rocm-6.2.2/runtests && \
              sbatch < test.sbatch \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/rocm-build-rocm-6.2.2/runtests && \
              sbatch < test.sbatch |& tee jobid.info \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  build-rocm-build-rocm-6_2_3:
    needs: Prepare-Build-Containers
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta
    steps:
      - run: ./lumi-containers-build.sh ./rocm/build-rocm-6.2.3.done 1
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  trf-rocm-build-rocm-6_2_3:
    needs: build-rocm-build-rocm-6_2_3
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-trf
    steps:
      - run: LUMI_TIMESTAMP="gh-${{ github.run_id }}/rocm-build-rocm-6.2.3" TARGET_FILE="./rocm/build-rocm-6.2.3.done" ./lumi-containers-transfer.sh
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  test-rocm-build-rocm-6_2_3:
    needs: trf-rocm-build-rocm-6_2_3
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-test
    steps:
      - name: build SIF image
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/rocm-build-rocm-6.2.3/runtests && \
              srun -p standard-g -N 1 -n 1 -c 56 -t 1:00:00 $SINGULARITY_BUILD_MAX_TIME ./build-singularity-images.sh \
              '"
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/rocm-build-rocm-6.2.3/runtests && \
              sbatch < test.sbatch \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/rocm-build-rocm-6.2.3/runtests && \
              sbatch < test.sbatch |& tee jobid.info \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  build-rocm-build-rocm-5_7_3:
    needs: Prepare-Build-Containers
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta
    steps:
      - run: ./lumi-containers-build.sh ./rocm/build-rocm-5.7.3.done 1
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  trf-rocm-build-rocm-5_7_3:
    needs: build-rocm-build-rocm-5_7_3
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-trf
    steps:
      - run: LUMI_TIMESTAMP="gh-${{ github.run_id }}/rocm-build-rocm-5.7.3" TARGET_FILE="./rocm/build-rocm-5.7.3.done" ./lumi-containers-transfer.sh
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  test-rocm-build-rocm-5_7_3:
    needs: trf-rocm-build-rocm-5_7_3
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-test
    steps:
      - name: build SIF image
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/rocm-build-rocm-5.7.3/runtests && \
              srun -p standard-g -N 1 -n 1 -c 56 -t 1:00:00 $SINGULARITY_BUILD_MAX_TIME ./build-singularity-images.sh \
              '"
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/rocm-build-rocm-5.7.3/runtests && \
              sbatch < test.sbatch \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/rocm-build-rocm-5.7.3/runtests && \
              sbatch < test.sbatch |& tee jobid.info \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  build-rocm-build-rocm-asan-6_2_4:
    needs: Prepare-Build-Containers
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta
    steps:
      - run: ./lumi-containers-build.sh ./rocm/build-rocm-asan-6.2.4.done 1
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  trf-rocm-build-rocm-asan-6_2_4:
    needs: build-rocm-build-rocm-asan-6_2_4
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-trf
    steps:
      - run: LUMI_TIMESTAMP="gh-${{ github.run_id }}/rocm-build-rocm-asan-6.2.4" TARGET_FILE="./rocm/build-rocm-asan-6.2.4.done" ./lumi-containers-transfer.sh
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  test-rocm-build-rocm-asan-6_2_4:
    needs: trf-rocm-build-rocm-asan-6_2_4
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-test
    steps:
      - name: build SIF image
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/rocm-build-rocm-asan-6.2.4/runtests && \
              srun -p standard-g -N 1 -n 1 -c 56 -t 1:00:00 $SINGULARITY_BUILD_MAX_TIME ./build-singularity-images.sh \
              '"
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/rocm-build-rocm-asan-6.2.4/runtests && \
              sbatch < test.sbatch \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/rocm-build-rocm-asan-6.2.4/runtests && \
              sbatch < test.sbatch |& tee jobid.info \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  build-rocm-build-rocm-asan-6_1_3:
    needs: Prepare-Build-Containers
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta
    steps:
      - run: ./lumi-containers-build.sh ./rocm/build-rocm-asan-6.1.3.done 1
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  trf-rocm-build-rocm-asan-6_1_3:
    needs: build-rocm-build-rocm-asan-6_1_3
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-trf
    steps:
      - run: LUMI_TIMESTAMP="gh-${{ github.run_id }}/rocm-build-rocm-asan-6.1.3" TARGET_FILE="./rocm/build-rocm-asan-6.1.3.done" ./lumi-containers-transfer.sh
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  test-rocm-build-rocm-asan-6_1_3:
    needs: trf-rocm-build-rocm-asan-6_1_3
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-test
    steps:
      - name: build SIF image
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/rocm-build-rocm-asan-6.1.3/runtests && \
              srun -p standard-g -N 1 -n 1 -c 56 -t 1:00:00 $SINGULARITY_BUILD_MAX_TIME ./build-singularity-images.sh \
              '"
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/rocm-build-rocm-asan-6.1.3/runtests && \
              sbatch < test.sbatch \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/rocm-build-rocm-asan-6.1.3/runtests && \
              sbatch < test.sbatch |& tee jobid.info \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  build-mpi4py-build-rocm-6_2_4-python-3_12-mpi4py-3_1_6:
    needs: build-rocm-build-rocm-6_2_4
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta
    steps:
      - run: ./lumi-containers-build.sh ./mpi4py/build-rocm-6.2.4-python-3.12-mpi4py-3.1.6.done 1
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  trf-mpi4py-build-rocm-6_2_4-python-3_12-mpi4py-3_1_6:
    needs: build-mpi4py-build-rocm-6_2_4-python-3_12-mpi4py-3_1_6
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-trf
    steps:
      - run: LUMI_TIMESTAMP="gh-${{ github.run_id }}/mpi4py-build-rocm-6.2.4-python-3.12-mpi4py-3.1.6" TARGET_FILE="./mpi4py/build-rocm-6.2.4-python-3.12-mpi4py-3.1.6.done" ./lumi-containers-transfer.sh
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  test-mpi4py-build-rocm-6_2_4-python-3_12-mpi4py-3_1_6:
    needs: trf-mpi4py-build-rocm-6_2_4-python-3_12-mpi4py-3_1_6
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-test
    steps:
      - name: build SIF image
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/mpi4py-build-rocm-6.2.4-python-3.12-mpi4py-3.1.6/runtests && \
              srun -p standard-g -N 1 -n 1 -c 56 -t 1:00:00 $SINGULARITY_BUILD_MAX_TIME ./build-singularity-images.sh \
              '"
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/mpi4py-build-rocm-6.2.4-python-3.12-mpi4py-3.1.6/runtests && \
              sbatch < test.sbatch \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/mpi4py-build-rocm-6.2.4-python-3.12-mpi4py-3.1.6/runtests && \
              sbatch < test.sbatch |& tee jobid.info \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  build-tensorflow-build-rocm-6_2_3-python-3_10-tensorflow-2_16_2-horovod-0_28_1:
    needs: build-rocm-build-rocm-6_2_3
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta
    steps:
      - run: ./lumi-containers-build.sh ./tensorflow/build-rocm-6.2.3-python-3.10-tensorflow-2.16.2-horovod-0.28.1.done 1
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  trf-tensorflow-build-rocm-6_2_3-python-3_10-tensorflow-2_16_2-horovod-0_28_1:
    needs: build-tensorflow-build-rocm-6_2_3-python-3_10-tensorflow-2_16_2-horovod-0_28_1
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-trf
    steps:
      - run: LUMI_TIMESTAMP="gh-${{ github.run_id }}/tensorflow-build-rocm-6.2.3-python-3.10-tensorflow-2.16.2-horovod-0.28.1" TARGET_FILE="./tensorflow/build-rocm-6.2.3-python-3.10-tensorflow-2.16.2-horovod-0.28.1.done" ./lumi-containers-transfer.sh
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  test-tensorflow-build-rocm-6_2_3-python-3_10-tensorflow-2_16_2-horovod-0_28_1:
    needs: trf-tensorflow-build-rocm-6_2_3-python-3_10-tensorflow-2_16_2-horovod-0_28_1
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-test
    steps:
      - name: build SIF image
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/tensorflow-build-rocm-6.2.3-python-3.10-tensorflow-2.16.2-horovod-0.28.1/runtests && \
              srun -p standard-g -N 1 -n 1 -c 56 -t 1:00:00 $SINGULARITY_BUILD_MAX_TIME ./build-singularity-images.sh \
              '"
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/tensorflow-build-rocm-6.2.3-python-3.10-tensorflow-2.16.2-horovod-0.28.1/runtests && \
              sbatch < test.sbatch \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/tensorflow-build-rocm-6.2.3-python-3.10-tensorflow-2.16.2-horovod-0.28.1/runtests && \
              sbatch < test.sbatch |& tee jobid.info \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  build-alphafold-build-rocm-6_2_4-python-3_10-alphafold-f251de6:
    needs: build-rocm-build-rocm-6_2_4
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta
    steps:
      - run: ./lumi-containers-build.sh ./alphafold/build-rocm-6.2.4-python-3.10-alphafold-f251de6.done 1
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  trf-alphafold-build-rocm-6_2_4-python-3_10-alphafold-f251de6:
    needs: build-alphafold-build-rocm-6_2_4-python-3_10-alphafold-f251de6
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-trf
    steps:
      - run: LUMI_TIMESTAMP="gh-${{ github.run_id }}/alphafold-build-rocm-6.2.4-python-3.10-alphafold-f251de6" TARGET_FILE="./alphafold/build-rocm-6.2.4-python-3.10-alphafold-f251de6.done" ./lumi-containers-transfer.sh
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  test-alphafold-build-rocm-6_2_4-python-3_10-alphafold-f251de6:
    needs: trf-alphafold-build-rocm-6_2_4-python-3_10-alphafold-f251de6
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-test
    steps:
      - name: build SIF image
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/alphafold-build-rocm-6.2.4-python-3.10-alphafold-f251de6/runtests && \
              srun -p standard-g -N 1 -n 1 -c 56 -t 1:00:00 $SINGULARITY_BUILD_MAX_TIME ./build-singularity-images.sh \
              '"
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/alphafold-build-rocm-6.2.4-python-3.10-alphafold-f251de6/runtests && \
              sbatch < test.sbatch \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/alphafold-build-rocm-6.2.4-python-3.10-alphafold-f251de6/runtests && \
              sbatch < test.sbatch |& tee jobid.info \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  build-pytorch-build-rocm-6_1_3-python-3_12-pytorch-v2_4_1:
    needs: build-rocm-build-rocm-6_1_3
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta
    steps:
      - run: ./lumi-containers-build.sh ./pytorch/build-rocm-6.1.3-python-3.12-pytorch-v2.4.1.done 1
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  trf-pytorch-build-rocm-6_1_3-python-3_12-pytorch-v2_4_1:
    needs: build-pytorch-build-rocm-6_1_3-python-3_12-pytorch-v2_4_1
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-trf
    steps:
      - run: LUMI_TIMESTAMP="gh-${{ github.run_id }}/pytorch-build-rocm-6.1.3-python-3.12-pytorch-v2.4.1" TARGET_FILE="./pytorch/build-rocm-6.1.3-python-3.12-pytorch-v2.4.1.done" ./lumi-containers-transfer.sh
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  test-pytorch-build-rocm-6_1_3-python-3_12-pytorch-v2_4_1:
    needs: trf-pytorch-build-rocm-6_1_3-python-3_12-pytorch-v2_4_1
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-test
    steps:
      - name: build SIF image
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/pytorch-build-rocm-6.1.3-python-3.12-pytorch-v2.4.1/runtests && \
              srun -p standard-g -N 1 -n 1 -c 56 -t 1:00:00 $SINGULARITY_BUILD_MAX_TIME ./build-singularity-images.sh \
              '"
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/pytorch-build-rocm-6.1.3-python-3.12-pytorch-v2.4.1/runtests && \
              sbatch < test.sbatch \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/pytorch-build-rocm-6.1.3-python-3.12-pytorch-v2.4.1/runtests && \
              sbatch < test.sbatch |& tee jobid.info \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  build-pytorch-build-rocm-6_2_0-python-3_12-pytorch-20240801-vllm-c7a3a47:
    needs: build-rocm-build-rocm-6_2_0
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta
    steps:
      - run: ./lumi-containers-build.sh ./pytorch/build-rocm-6.2.0-python-3.12-pytorch-20240801-vllm-c7a3a47.done 1
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  trf-pytorch-build-rocm-6_2_0-python-3_12-pytorch-20240801-vllm-c7a3a47:
    needs: build-pytorch-build-rocm-6_2_0-python-3_12-pytorch-20240801-vllm-c7a3a47
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-trf
    steps:
      - run: LUMI_TIMESTAMP="gh-${{ github.run_id }}/pytorch-build-rocm-6.2.0-python-3.12-pytorch-20240801-vllm-c7a3a47" TARGET_FILE="./pytorch/build-rocm-6.2.0-python-3.12-pytorch-20240801-vllm-c7a3a47.done" ./lumi-containers-transfer.sh
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  test-pytorch-build-rocm-6_2_0-python-3_12-pytorch-20240801-vllm-c7a3a47:
    needs: trf-pytorch-build-rocm-6_2_0-python-3_12-pytorch-20240801-vllm-c7a3a47
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-test
    steps:
      - name: build SIF image
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/pytorch-build-rocm-6.2.0-python-3.12-pytorch-20240801-vllm-c7a3a47/runtests && \
              srun -p standard-g -N 1 -n 1 -c 56 -t 1:00:00 $SINGULARITY_BUILD_MAX_TIME ./build-singularity-images.sh \
              '"
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/pytorch-build-rocm-6.2.0-python-3.12-pytorch-20240801-vllm-c7a3a47/runtests && \
              sbatch < test.sbatch \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/pytorch-build-rocm-6.2.0-python-3.12-pytorch-20240801-vllm-c7a3a47/runtests && \
              sbatch < test.sbatch |& tee jobid.info \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  build-pytorch-build-rocm-6_2_4-python-3_12-pytorch-v2_5_1:
    needs: build-rocm-build-rocm-6_2_4
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta
    steps:
      - run: ./lumi-containers-build.sh ./pytorch/build-rocm-6.2.4-python-3.12-pytorch-v2.5.1.done 1
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  trf-pytorch-build-rocm-6_2_4-python-3_12-pytorch-v2_5_1:
    needs: build-pytorch-build-rocm-6_2_4-python-3_12-pytorch-v2_5_1
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-trf
    steps:
      - run: LUMI_TIMESTAMP="gh-${{ github.run_id }}/pytorch-build-rocm-6.2.4-python-3.12-pytorch-v2.5.1" TARGET_FILE="./pytorch/build-rocm-6.2.4-python-3.12-pytorch-v2.5.1.done" ./lumi-containers-transfer.sh
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  test-pytorch-build-rocm-6_2_4-python-3_12-pytorch-v2_5_1:
    needs: trf-pytorch-build-rocm-6_2_4-python-3_12-pytorch-v2_5_1
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-test
    steps:
      - name: build SIF image
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/pytorch-build-rocm-6.2.4-python-3.12-pytorch-v2.5.1/runtests && \
              srun -p standard-g -N 1 -n 1 -c 56 -t 1:00:00 $SINGULARITY_BUILD_MAX_TIME ./build-singularity-images.sh \
              '"
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/pytorch-build-rocm-6.2.4-python-3.12-pytorch-v2.5.1/runtests && \
              sbatch < test.sbatch \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/pytorch-build-rocm-6.2.4-python-3.12-pytorch-v2.5.1/runtests && \
              sbatch < test.sbatch |& tee jobid.info \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  build-pytorch-build-rocm-6_2_3-python-3_12-pytorch-v2_5_1:
    needs: build-rocm-build-rocm-6_2_3
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta
    steps:
      - run: ./lumi-containers-build.sh ./pytorch/build-rocm-6.2.3-python-3.12-pytorch-v2.5.1.done 1
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  trf-pytorch-build-rocm-6_2_3-python-3_12-pytorch-v2_5_1:
    needs: build-pytorch-build-rocm-6_2_3-python-3_12-pytorch-v2_5_1
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-trf
    steps:
      - run: LUMI_TIMESTAMP="gh-${{ github.run_id }}/pytorch-build-rocm-6.2.3-python-3.12-pytorch-v2.5.1" TARGET_FILE="./pytorch/build-rocm-6.2.3-python-3.12-pytorch-v2.5.1.done" ./lumi-containers-transfer.sh
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  test-pytorch-build-rocm-6_2_3-python-3_12-pytorch-v2_5_1:
    needs: trf-pytorch-build-rocm-6_2_3-python-3_12-pytorch-v2_5_1
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-test
    steps:
      - name: build SIF image
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/pytorch-build-rocm-6.2.3-python-3.12-pytorch-v2.5.1/runtests && \
              srun -p standard-g -N 1 -n 1 -c 56 -t 1:00:00 $SINGULARITY_BUILD_MAX_TIME ./build-singularity-images.sh \
              '"
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/pytorch-build-rocm-6.2.3-python-3.12-pytorch-v2.5.1/runtests && \
              sbatch < test.sbatch \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/pytorch-build-rocm-6.2.3-python-3.12-pytorch-v2.5.1/runtests && \
              sbatch < test.sbatch |& tee jobid.info \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  build-pytorch-build-rocm-6_0_3-python-3_12-pytorch-v2_3_1:
    needs: build-rocm-build-rocm-6_0_3
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta
    steps:
      - run: ./lumi-containers-build.sh ./pytorch/build-rocm-6.0.3-python-3.12-pytorch-v2.3.1.done 1
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  trf-pytorch-build-rocm-6_0_3-python-3_12-pytorch-v2_3_1:
    needs: build-pytorch-build-rocm-6_0_3-python-3_12-pytorch-v2_3_1
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-trf
    steps:
      - run: LUMI_TIMESTAMP="gh-${{ github.run_id }}/pytorch-build-rocm-6.0.3-python-3.12-pytorch-v2.3.1" TARGET_FILE="./pytorch/build-rocm-6.0.3-python-3.12-pytorch-v2.3.1.done" ./lumi-containers-transfer.sh
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  test-pytorch-build-rocm-6_0_3-python-3_12-pytorch-v2_3_1:
    needs: trf-pytorch-build-rocm-6_0_3-python-3_12-pytorch-v2_3_1
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-test
    steps:
      - name: build SIF image
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/pytorch-build-rocm-6.0.3-python-3.12-pytorch-v2.3.1/runtests && \
              srun -p standard-g -N 1 -n 1 -c 56 -t 1:00:00 $SINGULARITY_BUILD_MAX_TIME ./build-singularity-images.sh \
              '"
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/pytorch-build-rocm-6.0.3-python-3.12-pytorch-v2.3.1/runtests && \
              sbatch < test.sbatch \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/pytorch-build-rocm-6.0.3-python-3.12-pytorch-v2.3.1/runtests && \
              sbatch < test.sbatch |& tee jobid.info \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  build-pytorch-build-rocm-6_2_1-python-3_12-pytorch-20240918-vllm-4075b35:
    needs: build-rocm-build-rocm-6_2_1
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta
    steps:
      - run: ./lumi-containers-build.sh ./pytorch/build-rocm-6.2.1-python-3.12-pytorch-20240918-vllm-4075b35.done 1
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  trf-pytorch-build-rocm-6_2_1-python-3_12-pytorch-20240918-vllm-4075b35:
    needs: build-pytorch-build-rocm-6_2_1-python-3_12-pytorch-20240918-vllm-4075b35
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-trf
    steps:
      - run: LUMI_TIMESTAMP="gh-${{ github.run_id }}/pytorch-build-rocm-6.2.1-python-3.12-pytorch-20240918-vllm-4075b35" TARGET_FILE="./pytorch/build-rocm-6.2.1-python-3.12-pytorch-20240918-vllm-4075b35.done" ./lumi-containers-transfer.sh
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  test-pytorch-build-rocm-6_2_1-python-3_12-pytorch-20240918-vllm-4075b35:
    needs: trf-pytorch-build-rocm-6_2_1-python-3_12-pytorch-20240918-vllm-4075b35
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-test
    steps:
      - name: build SIF image
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/pytorch-build-rocm-6.2.1-python-3.12-pytorch-20240918-vllm-4075b35/runtests && \
              srun -p standard-g -N 1 -n 1 -c 56 -t 1:00:00 $SINGULARITY_BUILD_MAX_TIME ./build-singularity-images.sh \
              '"
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/pytorch-build-rocm-6.2.1-python-3.12-pytorch-20240918-vllm-4075b35/runtests && \
              sbatch < test.sbatch \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/pytorch-build-rocm-6.2.1-python-3.12-pytorch-20240918-vllm-4075b35/runtests && \
              sbatch < test.sbatch |& tee jobid.info \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  build-pytorch-build-rocm-5_7_3-python-3_12-pytorch-v2_2_2:
    needs: build-rocm-build-rocm-5_7_3
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta
    steps:
      - run: ./lumi-containers-build.sh ./pytorch/build-rocm-5.7.3-python-3.12-pytorch-v2.2.2.done 1
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  trf-pytorch-build-rocm-5_7_3-python-3_12-pytorch-v2_2_2:
    needs: build-pytorch-build-rocm-5_7_3-python-3_12-pytorch-v2_2_2
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-trf
    steps:
      - run: LUMI_TIMESTAMP="gh-${{ github.run_id }}/pytorch-build-rocm-5.7.3-python-3.12-pytorch-v2.2.2" TARGET_FILE="./pytorch/build-rocm-5.7.3-python-3.12-pytorch-v2.2.2.done" ./lumi-containers-transfer.sh
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  test-pytorch-build-rocm-5_7_3-python-3_12-pytorch-v2_2_2:
    needs: trf-pytorch-build-rocm-5_7_3-python-3_12-pytorch-v2_2_2
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-test
    steps:
      - name: build SIF image
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/pytorch-build-rocm-5.7.3-python-3.12-pytorch-v2.2.2/runtests && \
              srun -p standard-g -N 1 -n 1 -c 56 -t 1:00:00 $SINGULARITY_BUILD_MAX_TIME ./build-singularity-images.sh \
              '"
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/pytorch-build-rocm-5.7.3-python-3.12-pytorch-v2.2.2/runtests && \
              sbatch < test.sbatch \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/pytorch-build-rocm-5.7.3-python-3.12-pytorch-v2.2.2/runtests && \
              sbatch < test.sbatch |& tee jobid.info \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  build-pytorch-build-rocm-6_2_4-python-3_12-pytorch-v2_6_0:
    needs: build-rocm-build-rocm-6_2_4
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta
    steps:
      - run: ./lumi-containers-build.sh ./pytorch/build-rocm-6.2.4-python-3.12-pytorch-v2.6.0.done 1
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  trf-pytorch-build-rocm-6_2_4-python-3_12-pytorch-v2_6_0:
    needs: build-pytorch-build-rocm-6_2_4-python-3_12-pytorch-v2_6_0
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-trf
    steps:
      - run: LUMI_TIMESTAMP="gh-${{ github.run_id }}/pytorch-build-rocm-6.2.4-python-3.12-pytorch-v2.6.0" TARGET_FILE="./pytorch/build-rocm-6.2.4-python-3.12-pytorch-v2.6.0.done" ./lumi-containers-transfer.sh
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  test-pytorch-build-rocm-6_2_4-python-3_12-pytorch-v2_6_0:
    needs: trf-pytorch-build-rocm-6_2_4-python-3_12-pytorch-v2_6_0
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-test
    steps:
      - name: build SIF image
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/pytorch-build-rocm-6.2.4-python-3.12-pytorch-v2.6.0/runtests && \
              srun -p standard-g -N 1 -n 1 -c 56 -t 1:00:00 $SINGULARITY_BUILD_MAX_TIME ./build-singularity-images.sh \
              '"
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/pytorch-build-rocm-6.2.4-python-3.12-pytorch-v2.6.0/runtests && \
              sbatch < test.sbatch \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/pytorch-build-rocm-6.2.4-python-3.12-pytorch-v2.6.0/runtests && \
              sbatch < test.sbatch |& tee jobid.info \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  build-pytorch-build-rocm-6_2_0-python-3_10-pytorch-v2_3_0:
    needs: build-rocm-build-rocm-6_2_0
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta
    steps:
      - run: ./lumi-containers-build.sh ./pytorch/build-rocm-6.2.0-python-3.10-pytorch-v2.3.0.done 1
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  trf-pytorch-build-rocm-6_2_0-python-3_10-pytorch-v2_3_0:
    needs: build-pytorch-build-rocm-6_2_0-python-3_10-pytorch-v2_3_0
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-trf
    steps:
      - run: LUMI_TIMESTAMP="gh-${{ github.run_id }}/pytorch-build-rocm-6.2.0-python-3.10-pytorch-v2.3.0" TARGET_FILE="./pytorch/build-rocm-6.2.0-python-3.10-pytorch-v2.3.0.done" ./lumi-containers-transfer.sh
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  test-pytorch-build-rocm-6_2_0-python-3_10-pytorch-v2_3_0:
    needs: trf-pytorch-build-rocm-6_2_0-python-3_10-pytorch-v2_3_0
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-test
    steps:
      - name: build SIF image
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/pytorch-build-rocm-6.2.0-python-3.10-pytorch-v2.3.0/runtests && \
              srun -p standard-g -N 1 -n 1 -c 56 -t 1:00:00 $SINGULARITY_BUILD_MAX_TIME ./build-singularity-images.sh \
              '"
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/pytorch-build-rocm-6.2.0-python-3.10-pytorch-v2.3.0/runtests && \
              sbatch < test.sbatch \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/pytorch-build-rocm-6.2.0-python-3.10-pytorch-v2.3.0/runtests && \
              sbatch < test.sbatch |& tee jobid.info \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  build-jax-build-rocm-6_2_4-python-3_12-jax-0_4_35:
    needs: build-rocm-build-rocm-6_2_4
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta
    steps:
      - run: ./lumi-containers-build.sh ./jax/build-rocm-6.2.4-python-3.12-jax-0.4.35.done 1
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  trf-jax-build-rocm-6_2_4-python-3_12-jax-0_4_35:
    needs: build-jax-build-rocm-6_2_4-python-3_12-jax-0_4_35
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-trf
    steps:
      - run: LUMI_TIMESTAMP="gh-${{ github.run_id }}/jax-build-rocm-6.2.4-python-3.12-jax-0.4.35" TARGET_FILE="./jax/build-rocm-6.2.4-python-3.12-jax-0.4.35.done" ./lumi-containers-transfer.sh
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  test-jax-build-rocm-6_2_4-python-3_12-jax-0_4_35:
    needs: trf-jax-build-rocm-6_2_4-python-3_12-jax-0_4_35
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-test
    steps:
      - name: build SIF image
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/jax-build-rocm-6.2.4-python-3.12-jax-0.4.35/runtests && \
              srun -p standard-g -N 1 -n 1 -c 56 -t 1:00:00 $SINGULARITY_BUILD_MAX_TIME ./build-singularity-images.sh \
              '"
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/jax-build-rocm-6.2.4-python-3.12-jax-0.4.35/runtests && \
              sbatch < test.sbatch \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/jax-build-rocm-6.2.4-python-3.12-jax-0.4.35/runtests && \
              sbatch < test.sbatch |& tee jobid.info \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  build-jax-build-rocm-6_2_0-python-3_12-jax-0_4_28:
    needs: build-rocm-build-rocm-6_2_0
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta
    steps:
      - run: ./lumi-containers-build.sh ./jax/build-rocm-6.2.0-python-3.12-jax-0.4.28.done 1
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  trf-jax-build-rocm-6_2_0-python-3_12-jax-0_4_28:
    needs: build-jax-build-rocm-6_2_0-python-3_12-jax-0_4_28
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-trf
    steps:
      - run: LUMI_TIMESTAMP="gh-${{ github.run_id }}/jax-build-rocm-6.2.0-python-3.12-jax-0.4.28" TARGET_FILE="./jax/build-rocm-6.2.0-python-3.12-jax-0.4.28.done" ./lumi-containers-transfer.sh
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  test-jax-build-rocm-6_2_0-python-3_12-jax-0_4_28:
    needs: trf-jax-build-rocm-6_2_0-python-3_12-jax-0_4_28
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta-test
    steps:
      - name: build SIF image
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/jax-build-rocm-6.2.0-python-3.12-jax-0.4.28/runtests && \
              srun -p standard-g -N 1 -n 1 -c 56 -t 1:00:00 $SINGULARITY_BUILD_MAX_TIME ./build-singularity-images.sh \
              '"
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/jax-build-rocm-6.2.0-python-3.12-jax-0.4.28/runtests && \
              sbatch < test.sbatch \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
      - name: issue SIF image testing
        run: |
          ssh lumi \
            "bash -ex -c '\
              cd /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }}/jax-build-rocm-6.2.0-python-3.12-jax-0.4.28/runtests && \
              sbatch < test.sbatch |& tee jobid.info \
              '"
        working-directory: /home/work/actions-runner-work/LUMI-containers/LUMI-containers/RecipesDocker
  Verify:
    needs:
      - test-rocm-build-rocm-asan-6_2_3
      - test-rocm-build-rocm-asan-6_2_2
      - test-rocm-build-rocm-6_2_0
      - test-rocm-build-rocm-6_2_4
      - test-rocm-build-rocm-6_1_3
      - test-rocm-build-rocm-6_0_3
      - test-rocm-build-rocm-6_2_1
      - test-rocm-build-rocm-6_2_2
      - test-rocm-build-rocm-6_2_3
      - test-rocm-build-rocm-5_7_3
      - test-rocm-build-rocm-asan-6_2_4
      - test-rocm-build-rocm-asan-6_1_3
      - test-mpi4py-build-rocm-6_2_4-python-3_12-mpi4py-3_1_6
      - test-tensorflow-build-rocm-6_2_3-python-3_10-tensorflow-2_16_2-horovod-0_28_1
      - test-alphafold-build-rocm-6_2_4-python-3_10-alphafold-f251de6
      - test-pytorch-build-rocm-6_1_3-python-3_12-pytorch-v2_4_1
      - test-pytorch-build-rocm-6_2_0-python-3_12-pytorch-20240801-vllm-c7a3a47
      - test-pytorch-build-rocm-6_2_4-python-3_12-pytorch-v2_5_1
      - test-pytorch-build-rocm-6_2_3-python-3_12-pytorch-v2_5_1
      - test-pytorch-build-rocm-6_0_3-python-3_12-pytorch-v2_3_1
      - test-pytorch-build-rocm-6_2_1-python-3_12-pytorch-20240918-vllm-4075b35
      - test-pytorch-build-rocm-5_7_3-python-3_12-pytorch-v2_2_2
      - test-pytorch-build-rocm-6_2_4-python-3_12-pytorch-v2_6_0
      - test-pytorch-build-rocm-6_2_0-python-3_10-pytorch-v2_3_0
      - test-jax-build-rocm-6_2_4-python-3_12-jax-0_4_35
      - test-jax-build-rocm-6_2_0-python-3_12-jax-0_4_28
    if: ${{ ! failure() && ! cancelled() }}
    runs-on: cpouta
    steps:
      - name: Verify tests
        run: |
          ssh lumi \
            "bash -ex -c '\
              ls /pfs/lustrep4/scratch/project_462000475/containers-ci/staging-area/gh-${{ github.run_id }} \
              '"
        working-directory: ${{ github.workspace }}/RecipesDocker

  # Stop-Runner:
  #   needs: Build-Container
  #   if: ${{ ! failure() && ! cancelled() }}
  #   runs-on: ubuntu-latest
  #   container:
  #     image: "ghcr.io/${{ github.repository_owner }}/openstack:latest"
  #     credentials:
  #       username: ${{ github.actor }}
  #       password: ${{ secrets.github_token }}
  #     env:
  #       OS_AUTH_TYPE: "${{ vars.OS_AUTH_TYPE }}"
  #       OS_AUTH_URL: "${{ vars.OS_AUTH_URL }}"
  #       OS_IDENTITY_API_VERSION: "${{ vars.OS_IDENTITY_API_VERSION }}"
  #       OS_REGION_NAME: "${{ vars.OS_REGION_NAME }}"
  #       OS_INTERFACE: "${{ vars.OS_INTERFACE }}"
  #       OS_APPLICATION_CREDENTIAL_ID: "${{ secrets.OS_APPLICATION_CREDENTIAL_ID }}"
  #       OS_APPLICATION_CREDENTIAL_SECRET: "${{ secrets.OS_APPLICATION_CREDENTIAL_SECRET }}"
  #   steps:
  #     - name: Remove instance
  #       run: openstack server delete --wait production_containers_workflow

